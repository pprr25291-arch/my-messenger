<!DOCTYPE html>
<html>
<head>
    <title>Anonimo - Чат</title>
    <link rel="stylesheet" href="/style.css">
    <script>
        const USERNAME = '<%= username %>';
        const USER_TOKEN = document.cookie.replace(/(?:(?:^|.*;\s*)token\s*=\s*([^;]*).*$)|^.*$/, '$1');
    </script>
</head>
<body>
    <div class="chat-container">
        <header>
            <h2>Anonimo</h2>
            <div>
                <span>Добро пожаловать, <span id="username"><%= username %></span>!</span>
                <div class="header-buttons">
                    <button id="globalBtn" class="header-btn active" type="button">Общий чат</button>
                    <button id="privateBtn" class="header-btn" type="button">Приватные сообщения</button>
                    <button class="header-btn" type="button" onclick="logout()">Выйти</button>
                </div>
            </div>
        </header>
        
        <div id="globalChat">
            <div id="messages"></div>
            <form id="messageForm">
                <input type="text" id="messageInput" placeholder="Введите сообщение..." autocomplete="off">
                <button type="submit">Отправить</button>
            </form>
        </div>
        
        <div id="privateChat" style="display: none;">
            <!-- Контент будет создан JavaScript -->
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/chat.js"></script>
    <script src="/private-chat.js"></script>
    
    <script>
        function switchToGlobal() {
            document.getElementById('globalChat').style.display = 'block';
            document.getElementById('privateChat').style.display = 'none';
            document.getElementById('globalBtn').classList.add('active');
            document.getElementById('privateBtn').classList.remove('active');
            scrollToBottom('messages');
        }

        function switchToPrivate() {
            document.getElementById('globalChat').style.display = 'none';
            document.getElementById('privateChat').style.display = 'block';
            document.getElementById('globalBtn').classList.remove('active');
            document.getElementById('privateBtn').classList.add('active');
            
            // Инициализируем приватный чат при переключении
            setTimeout(() => {
                if (window.initPrivateChat) {
                    const privateInstance = window.initPrivateChat();
                    if (privateInstance) {
                        privateInstance.loadConversations();
                    }
                }
            }, 100);
        }

        document.getElementById('globalBtn').addEventListener('click', switchToGlobal);
        document.getElementById('privateBtn').addEventListener('click', switchToPrivate);

        // Инициализируем базовые функции
        document.addEventListener('DOMContentLoaded', function() {
            window.privateChatInstance = new PrivateChat();
            console.log('Private chat instance created');
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html>
<head>
    <title>Anonka - –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</title>
    <link rel="stylesheet" href="/style.css">
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ JavaScript
        window.USERNAME = '<%= username %>';
        window.USER_TOKEN = '<%= token %>';
    </script>
    <style>
        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∞–ª—é—Ç—ã */
        .currency-section {
            padding: 20px 0;
        }

        .currency-balance {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .balance-display {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .currency-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px;
        }

        .balance-info {
            flex: 1;
        }

        .balance-label {
            display: block;
            font-size: 14px;
            opacity: 0.9;
        }

        .balance-amount {
            display: block;
            font-size: 28px;
            font-weight: bold;
        }

        .daily-reward-btn {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-weight: bold;
        }

        .daily-reward-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.3);
        }

        .daily-reward-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .daily-reward-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .reward-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .stat-label {
            font-weight: 500;
            color: #6c757d;
        }

        .stat-value {
            font-weight: bold;
            color: #28a745;
        }

        .currency-history {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
        }

        .history-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #f8f9fa;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-info {
            flex: 1;
        }

        .history-amount {
            font-weight: bold;
        }

        .history-amount.positive {
            color: #28a745;
        }

        .history-amount.negative {
            color: #dc3545;
        }

        .history-date {
            font-size: 12px;
            color: #6c757d;
        }

        /* –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∞–ª—é—Ç–æ–π */
        .currency-admin-controls {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
        }

        .admin-currency-form {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }

        .admin-currency-form h5 {
            margin-bottom: 15px;
            color: #495057;
        }

        .currency-controls {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 10px;
            align-items: end;
        }

        .currency-user-input {
            margin-bottom: 0;
        }

        .currency-amount-input {
            margin-bottom: 0;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–≥—Ä–∞–¥—ã */
        @keyframes coinBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .coin-animation {
            animation: coinBounce 0.6s ease-in-out;
        }

        .reward-notification {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }

        .history-empty {
            text-align: center;
            color: #6c757d;
            padding: 20px;
            font-style: italic;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞ –ø–æ–¥–∞—Ä–∫–æ–≤ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö */
        .gift-shop-section {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .gift-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .gift-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-color: #007bff;
        }

        .gift-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .gift-name {
            font-weight: 600;
            font-size: 12px;
            margin-bottom: 6px;
            color: #333;
        }

        .gift-price {
            color: #28a745;
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .gift-type {
            font-size: 10px;
            margin-bottom: 8px;
        }

        .buy-gift-btn {
            width: 100%;
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s ease;
        }

        .buy-gift-btn:not(.owned):not(:disabled) {
            background: #28a745;
            color: white;
        }

        .buy-gift-btn:not(.owned):not(:disabled):hover {
            background: #218838;
        }

        .buy-gift-btn.owned {
            background: #6c757d;
            color: white;
            cursor: not-allowed;
        }

        .buy-gift-btn:disabled {
            background: #dc3545;
            color: white;
            cursor: not-allowed;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –ø–æ–¥–∞—Ä–∫–æ–≤ */
        .owned-gift-item {
            text-align: center;
            padding: 8px;
            background: white;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }

        .owned-gift-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .owned-gift-name {
            font-size: 9px;
            color: #6c757d;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ */
        .category-btn.active {
            background: #007bff !important;
            color: white !important;
            border-color: #007bff !important;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ */
        @keyframes giftPurchase {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .gift-purchase-animation {
            animation: giftPurchase 0.6s ease-in-out;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <header>
            <h2>Anonka</h2>
            <div class="header-content">
                <span>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span id="username"><%= username %></span>!</span>
                <div class="header-buttons">
                    <div class="header-buttons">
                        <button id="notificationsBtn" class="header-btn" type="button">üì¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</button>
                        <button id="privateBtn" class="header-btn active" type="button">üí¨ –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è</button>
                        <% if (username === 'admin') { %>
                        <button id="adminBtn" class="header-btn" type="button">‚öôÔ∏è –ê–¥–º–∏–Ω</button>
                        <% } %>
                        <button id="settingsBtn" class="header-btn" type="button">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="chat-content">
            <!-- –ü–∞–Ω–µ–ª—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
            <div id="notificationsPanel" class="chat-section" style="display: none;">
                <div class="notifications-header">
                    <h3>üì¢ –°–∏—Å—Ç–µ–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
                    <p>–í–∞–∂–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã</p>
                </div>
                <div id="notifications" class="notifications-list">
                    <div class="no-notifications">
                        <div class="no-notifications-icon">üìã</div>
                        <h3>–ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h3>
                        <p>–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å–∏—Å—Ç–µ–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</p>
                    </div>
                </div>
            </div>
            
            <!-- –ü—Ä–∏–≤–∞—Ç–Ω—ã–π —á–∞—Ç -->
            <div id="privateChat" class="chat-section">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω JavaScript -->
                <div class="loading-chat">
                    <div class="loading-spinner"></div>
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ —á–∞—Ç–∞...</p>
                </div>
            </div>
        </div>
    </div>

    
        <script src="/socket.io/socket.io.js"></script>
    <script src="call-manager.js"></script>
    <script src="voice-message-manager.js"></script>
    <script src="currency-manager.js"></script>
    <script src="profile-manager.js"></script>
    <script src="settings-manager.js"></script>
    <script src="group-chat.js"></script>
    <script src="private-chat.js"></script>
    <script src="chat.js"></script>
    
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function logout() {
            fetch('/api/logout', { method: 'POST' })
                .then(() => window.location.href = '/')
                .catch(() => window.location.href = '/');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Starting application initialization...');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —á–∞—Ç
            setTimeout(() => {
                if (!window.privateChatInstance) {
                    console.log('üîÑ Creating PrivateChat instance...');
                    window.privateChatInstance = new PrivateChat();
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
                    setTimeout(() => {
                        if (window.privateChatInstance && window.privateChatInstance.isInitialized) {
                            console.log('‚úÖ PrivateChat instance created successfully');
                        } else {
                            console.error('‚ùå Failed to create PrivateChat instance');
                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º fallback –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                            showFallbackChatInterface();
                        }
                    }, 2000);
                }
            }, 100);

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
            const username = document.getElementById('username')?.textContent;
            if (username === 'admin') {
                const adminBtn = document.getElementById('adminBtn');
                if (adminBtn) {
                    adminBtn.addEventListener('click', () => {
                        if (window.privateChatInstance && typeof window.privateChatInstance.toggleAdminPanel === 'function') {
                            window.privateChatInstance.toggleAdminPanel();
                        } else {
                            console.error('Admin panel method not available');
                            // Fallback –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
                            showFallbackAdminPanel();
                        }
                    });
                }
            }
        });

        // Fallback —Ñ—É–Ω–∫—Ü–∏–∏
        function showFallbackChatInterface() {
            const privateChat = document.getElementById('privateChat');
            if (privateChat) {
                privateChat.innerHTML = `
                    <div class="fallback-chat">
                        <div class="fallback-header">
                            <h3>üí¨ –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è</h3>
                            <p>–û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</p>
                        </div>
                        <div class="fallback-content">
                            <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.</p>
                            <button onclick="location.reload()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</button>
                        </div>
                    </div>
                `;
            }
        }

        function showFallbackAdminPanel() {
            const adminPanel = document.createElement('div');
            adminPanel.id = 'fallbackAdminPanel';
            adminPanel.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 0 20px rgba(0,0,0,0.3);
                z-index: 10000;
                max-width: 400px;
                width: 90%;
            `;
            
            adminPanel.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0;">‚öôÔ∏è –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h3>
                    <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; font-size: 20px; cursor: pointer;">‚úï</button>
                </div>
                <p>–û—Å–Ω–æ–≤–Ω–∞—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.</p>
                <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.</p>
                <button onclick="location.reload()" style="width: 100%; padding: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;">
                    üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                </button>
            `;
            
            document.body.appendChild(adminPanel);
        }
    </script>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–ø–∏—Å–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è -->
    <div id="voiceRecordModal" class="modal-overlay" style="display: none;">
        <div class="modal-content voice-recording-panel">
            <div class="modal-header">
                <h4>üé§ –ó–∞–ø–∏—Å—å –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è</h4>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="recording-status">
                    <div id="recordingTimer">00:00</div>
                    <div id="recordingStatus">–ì–æ—Ç–æ–≤ –∫ –∑–∞–ø–∏—Å–∏...</div>
                </div>
                
                <div class="voice-visualization">
                    <canvas id="voiceVisualization" width="400" height="80"></canvas>
                </div>
                
                <div class="recording-controls">
                    <button id="startRecordingBtn" class="btn btn-success">
                        üé§ –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å
                    </button>
                    <button id="stopRecordingBtn" class="btn btn-danger" disabled>
                        ‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                    </button>
                    <button id="playRecordingBtn" class="btn btn-info" disabled>
                        ‚ñ∂Ô∏è –ü—Ä–æ—Å–ª—É—à–∞—Ç—å
                    </button>
                    <button id="sendVoiceBtn" class="btn btn-primary" disabled>
                        üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                    </button>
                    <button id="cancelRecordingBtn" class="btn btn-warning">
                        ‚ùå –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
                
                <div class="recording-info">
                    <p>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 5 –º–∏–Ω—É—Ç</p>
                    <p>–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 1 —Å–µ–∫—É–Ω–¥–∞</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–º–µ–Ω—ã –∞–≤–∞—Ç–∞—Ä–∞ -->
    <div id="avatarModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üñºÔ∏è –°–º–µ–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∞</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="avatar-section">
                    <div class="avatar-preview" id="avatarPreview">
                        <img id="avatarPreviewImg" src="/default-avatar.png" alt="–ê–≤–∞—Ç–∞—Ä">
                        <div class="avatar-overlay">
                            <span>üì∑</span>
                            <span>–°–º–µ–Ω–∏—Ç—å</span>
                        </div>
                    </div>
                    <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                    <button id="uploadAvatarBtn" class="btn-secondary">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</button>
                </div>
                <div class="avatar-controls" style="margin-top: 20px; display: flex; gap: 10px; justify-content: center;">
                    <button id="saveAvatarBtn" class="btn-primary" disabled>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button id="cancelAvatarBtn" class="btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div id="settingsModal" class="modal-overlay" style="display: none;">
        <div class="modal-content settings-modal">
            <div class="modal-header">
                <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</h3>
                <button class="close-modal">&times;</button>
            </div>
            
            <div class="modal-body">
                <!-- –í–∫–ª–∞–¥–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
                <div class="settings-tabs">
                    <button class="settings-tab active" data-tab="profile">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
                    <button class="settings-tab" data-tab="appearance">üé® –í–Ω–µ—à–Ω–∏–π –≤–∏–¥</button>
                    <button class="settings-tab" data-tab="privacy">üîí –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å</button>
                    <button class="settings-tab" data-tab="notifications">üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</button>
                    <button class="settings-tab" data-tab="currency">ü™ô –í–∞–ª—é—Ç–∞</button>
                </div>
                
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–æ–∫ -->
                <div class="settings-content">
                    <!-- –í–∫–ª–∞–¥–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
                    <div id="tab-profile" class="settings-tab-content active">
                        <div class="avatar-section">
                            <h4>üñºÔ∏è –ê–≤–∞—Ç–∞—Ä –ø—Ä–æ—Ñ–∏–ª—è</h4>
                            <div class="avatar-container">
                                <div class="avatar-preview-large" id="avatarPreviewLarge">
                                    <img id="avatarPreviewImgLarge" src="/default-avatar.png" alt="–ê–≤–∞—Ç–∞—Ä">
                                    <div class="avatar-overlay">
                                        <span>üì∑</span>
                                        <span>–°–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</span>
                                    </div>
                                </div>
                                <div class="avatar-controls">
                                    <input type="file" id="avatarInputSettings" accept="image/*" style="display: none;">
                                    <button id="uploadAvatarBtnSettings" class="btn-secondary">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</button>
                                    <button id="removeAvatarBtn" class="btn-warning">–£–¥–∞–ª–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="profile-info">
                            <h4>üìù –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è</h4>
                            <div class="form-group">
                                <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                                <input type="text" id="usernameDisplay" class="form-input" readonly>
                            </div>
                            <div class="form-group">
                                <label>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</label>
                                <input type="text" id="registrationDate" class="form-input" readonly>
                            </div>
                            <div class="form-group">
                                <label>–°—Ç–∞—Ç—É—Å:</label>
                                <select id="userStatus" class="form-input">
                                    <option value="online">üü¢ Online</option>
                                    <option value="away">üü° –û—Ç–æ—à–µ–ª</option>
                                    <option value="dnd">üî¥ –ù–µ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å</option>
                                    <option value="offline">‚ö´ Offline</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –í–∫–ª–∞–¥–∫–∞ –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ -->
                    <div id="tab-appearance" class="settings-tab-content">
                        <div class="theme-section">
                            <h4>üé® –í—ã–±–æ—Ä —Ç–µ–º—ã</h4>
                            <div class="theme-selector">
                                <div class="theme-option" data-theme="light">
                                    <div class="theme-preview light-theme">
                                        <div class="preview-header"></div>
                                        <div class="preview-content"></div>
                                    </div>
                                    <span>üåû –°–≤–µ—Ç–ª–∞—è</span>
                                </div>
                                <div class="theme-option" data-theme="dark">
                                    <div class="theme-preview dark-theme">
                                        <div class="preview-header"></div>
                                        <div class="preview-content"></div>
                                    </div>
                                    <span>üåô –¢—ë–º–Ω–∞—è</span>
                                </div>
                                <div class="theme-option" data-theme="auto">
                                    <div class="theme-preview auto-theme">
                                        <div class="preview-header"></div>
                                        <div class="preview-content"></div>
                                    </div>
                                    <span>‚ö° –ê–≤—Ç–æ</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accent-color-section">
                            <h4>üé® –ê–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ü–≤–µ—Ç</h4>
                            <div class="color-selector">
                                <div class="color-option" data-color="#007bff" style="background: #007bff;"></div>
                                <div class="color-option" data-color="#28a745" style="background: #28a745;"></div>
                                <div class="color-option" data-color="#dc3545" style="background: #dc3545;"></div>
                                <div class="color-option" data-color="#ffc107" style="background: #ffc107;"></div>
                                <div class="color-option" data-color="#6f42c1" style="background: #6f42c1;"></div>
                                <div class="color-option" data-color="#fd7e14" style="background: #fd7e14;"></div>
                            </div>
                        </div>
                        
                        <div class="layout-options">
                            <h4>üìê –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</h4>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="compactMode" class="checkbox-input">
                                    <span class="checkbox-custom"></span>
                                    –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–µ–∂–∏–º
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="showAvatars" class="checkbox-input" checked>
                                    <span class="checkbox-custom"></span>
                                    –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∞–≤–∞—Ç–∞—Ä—ã
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="animations" class="checkbox-input" checked>
                                    <span class="checkbox-custom"></span>
                                    –ê–Ω–∏–º–∞—Ü–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –í–∫–ª–∞–¥–∫–∞ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏ -->
                    <div id="tab-privacy" class="settings-tab-content">
                        <div class="privacy-section">
                            <h4>üîí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏</h4>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="showOnlineStatus" class="checkbox-input" checked>
                                    <span class="checkbox-custom"></span>
                                    –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å –æ–Ω–ª–∞–π–Ω
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="allowGroupInvites" class="checkbox-input" checked>
                                    <span class="checkbox-custom"></span>
                                    –†–∞–∑—Ä–µ—à–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø—ã
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="allowPrivateMessages" class="checkbox-input" checked>
                                    <span class="checkbox-custom"></span>
                                    –†–∞–∑—Ä–µ—à–∏—Ç—å –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                                </label>
                            </div>
                        </div>
                        
                        <div class="security-section">
                            <h4>üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h4>
                            <button id="changePasswordBtn" class="btn-secondary">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
                            <button id="logoutAllBtn" class="btn-warning">–í—ã–π—Ç–∏ —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤</button>
                        </div>
                    </div>
                    
                    <!-- –í–∫–ª–∞–¥–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
                    <div id="tab-notifications" class="settings-tab-content">
                        <div class="notifications-section">
                            <h4>üîî –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h4>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="notifyMessages" class="checkbox-input" checked>
                                    <span class="checkbox-custom"></span>
                                    –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="notifyCalls" class="checkbox-input" checked>
                                    <span class="checkbox-custom"></span>
                                    –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–≤–æ–Ω–∫–∞—Ö
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="notifyMentions" class="checkbox-input" checked>
                                    <span class="checkbox-custom"></span>
                                    –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —É–ø–æ–º–∏–Ω–∞–Ω–∏—è—Ö
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="soundEnabled" class="checkbox-input" checked>
                                    <span class="checkbox-custom"></span>
                                    –ó–≤—É–∫–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                                </label>
                            </div>
                        </div>
                        
                        <div class="notification-sounds">
                            <h4>üîä –ó–≤—É–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h4>
                            <div class="form-group">
                                <label>–ú–µ–ª–æ–¥–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:</label>
                                <select id="notificationSound" class="form-input">
                                    <option value="default">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
                                    <option value="chime">–ö–æ–ª–æ–∫–æ–ª—å—á–∏–∫</option>
                                    <option value="ding">–ó–≤–æ–Ω–æ–∫</option>
                                    <option value="pop">–©–µ–ª—á–æ–∫</option>
                                </select>
                            </div>
                            <button id="testSoundBtn" class="btn-secondary">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–≤—É–∫</button>
                        </div>
                    </div>

                    <!-- –í–∫–ª–∞–¥–∫–∞ –≤–∞–ª—é—Ç—ã -->
                    <div id="tab-currency" class="settings-tab-content">
                        <div class="currency-section">
                            <h4>ü™ô –ë–∞–ª–∞–Ω—Å –∏ –Ω–∞–≥—Ä–∞–¥—ã</h4>
                            
                            <!-- –ë–ª–æ–∫ –±–∞–ª–∞–Ω—Å–∞ -->
                            <div class="currency-balance">
                                <div class="balance-display">
                                    <img src="/coin.png" class="currency-icon" alt="–ú–æ–Ω–µ—Ç—ã">
                                    <div class="balance-info">
                                        <span class="balance-label">–í–∞—à –±–∞–ª–∞–Ω—Å:</span>
                                        <span class="balance-amount" id="userBalance">0</span>
                                    </div>
                                </div>
                                <button id="dailyRewardBtn" class="btn-primary daily-reward-btn">
                                    üéÅ –ü–æ–ª—É—á–∏—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é –Ω–∞–≥—Ä–∞–¥—É
                                </button>
                            </div>
                            
                            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞–≥—Ä–∞–¥–∞—Ö -->
                            <div class="daily-reward-info">
                                <h5>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã</h5>
                                <div class="reward-stats">
                                    <div class="stat-item">
                                        <span class="stat-label">–¢–µ–∫—É—â–∞—è —Å–µ—Ä–∏—è:</span>
                                        <span class="stat-value" id="dailyStreak">0 –¥–Ω–µ–π</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">–°–ª–µ–¥—É—é—â–∞—è –Ω–∞–≥—Ä–∞–¥–∞:</span>
                                        <span class="stat-value" id="nextRewardTime">-</span>
                                    </div>
                                </div>
                            </div>

                            <!-- –ú–∞–≥–∞–∑–∏–Ω –ø–æ–¥–∞—Ä–∫–æ–≤ -->
                            <div class="gift-shop-section">
                                <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <h5 style="margin: 0;">üéÅ –ú–∞–≥–∞–∑–∏–Ω –ø–æ–¥–∞—Ä–∫–æ–≤</h5>
                                    <span class="gift-count" style="font-size: 12px; color: #6c757d;">
                                        –í–∞—à–∏—Ö –ø–æ–¥–∞—Ä–∫–æ–≤: <span id="ownedGiftsCount">0</span>
                                    </span>
                                </div>
                                
                                <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–¥–∞—Ä–∫–æ–≤ -->
                                <div class="gift-categories" style="display: flex; gap: 8px; margin-bottom: 15px; flex-wrap: wrap;">
                                    <button class="category-btn active" data-category="all" style="padding: 6px 12px; border: 1px solid #007bff; background: #007bff; color: white; border-radius: 15px; font-size: 12px; cursor: pointer;">–í—Å–µ</button>
                                    <button class="category-btn" data-category="decor" style="padding: 6px 12px; border: 1px solid #6c757d; background: white; color: #6c757d; border-radius: 15px; font-size: 12px; cursor: pointer;">üé® –£–∫—Ä–∞—à–µ–Ω–∏—è</button>
                                    <button class="category-btn" data-category="gift" style="padding: 6px 12px; border: 1px solid #6c757d; background: white; color: #6c757d; border-radius: 15px; font-size: 12px; cursor: pointer;">üéÅ –ü–æ–¥–∞—Ä–∫–∏</button>
                                    <button class="category-btn" data-category="premium" style="padding: 6px 12px; border: 1px solid #6c757d; background: white; color: #6c757d; border-radius: 15px; font-size: 12px; cursor: pointer;">üíé –ü—Ä–µ–º–∏—É–º</button>
                                </div>
                                
                                <!-- –°–µ—Ç–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤ -->
                                <div class="gifts-grid" id="giftsGrid" style="
                                    display: grid;
                                    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                                    gap: 12px;
                                    margin-bottom: 20px;
                                    max-height: 300px;
                                    overflow-y: auto;
                                    padding: 10px;
                                    background: #f8f9fa;
                                    border-radius: 10px;
                                ">
                                    <!-- –ü–æ–¥–∞—Ä–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                                </div>
                                
                                <!-- –°–ø–∏—Å–æ–∫ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –ø–æ–¥–∞—Ä–∫–æ–≤ -->
                                <div class="user-gifts-section">
                                    <h6 style="margin-bottom: 10px; color: #495057;">üéÅ –í–∞—à–∏ –ø–æ–¥–∞—Ä–∫–∏</h6>
                                    <div id="userGiftsList" class="user-gifts-list" style="
                                        display: grid;
                                        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
                                        gap: 8px;
                                        max-height: 120px;
                                        overflow-y: auto;
                                        padding: 10px;
                                        background: white;
                                        border: 1px solid #e9ecef;
                                        border-radius: 8px;
                                    ">
                                        <!-- –ö—É–ø–ª–µ–Ω–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                                    </div>
                                </div>
                            </div>
                            
                            <!-- –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π -->
                            <div class="currency-history" style="margin-top: 20px;">
                                <h5>üìä –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h5>
                                <div id="currencyHistory" class="history-list" style="max-height: 150px;">
                                    <div class="history-empty">–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –ø—É—Å—Ç–∞</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                <div class="settings-actions">
                    <button id="saveSettings" class="btn-primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                    <button id="resetSettings" class="btn-secondary">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                    <button id="logoutBtn" class="btn-warning">üö™ –í—ã–π—Ç–∏</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è -->
    <div id="changePasswordModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üîê –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="currentPassword" class="form-input">
                </div>
                <div class="form-group">
                    <label>–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="newPassword" class="form-input">
                </div>
                <div class="form-group">
                    <label>–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="confirmPassword" class="form-input">
                </div>
                <div class="password-strength" id="passwordStrength">
                    <div class="strength-bar"></div>
                    <div class="strength-text">–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –ø–∞—Ä–æ–ª—è: —Å–ª–∞–±—ã–π</div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="confirmPasswordChange" class="btn-primary">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
                <button class="btn-secondary close-modal">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

</body>
</html>

<script>
// –ö–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∞–ª—é—Ç–æ–π –∏ –º–∞–≥–∞–∑–∏–Ω–æ–º –ø–æ–¥–∞—Ä–∫–æ–≤
class CurrencyManager {
    constructor() {
        this.balance = 100;
        this.dailyStreak = 0;
        this.lastDailyReward = null;
        this.transactionHistory = [];
        this.isAdmin = false;
        
        this.init();
    }

    async init() {
        this.currentUser = document.getElementById('username')?.textContent;
        this.isAdmin = this.currentUser === 'admin';
        await this.loadUserData();
        this.setupEventListeners();
        this.updateDisplay();
        
        console.log('‚úÖ CurrencyManager initialized');
    }

    async loadUserData() {
        try {
            console.log('üîÑ Loading currency data for:', this.currentUser);
            
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞
            // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
            this.balance = 100;
            this.dailyStreak = 0;
            this.lastDailyReward = null;
            this.transactionHistory = [];
            
        } catch (error) {
            console.error('‚ùå Error loading currency data:', error);
            this.useDefaultCurrencyData();
        }
    }

    useDefaultCurrencyData() {
        this.balance = 100;
        this.dailyStreak = 0;
        this.lastDailyReward = null;
        this.transactionHistory = [];
        
        console.log('‚úÖ Using default currency data');
    }

    setupEventListeners() {
        // –ö–Ω–æ–ø–∫–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –Ω–∞–≥—Ä–∞–¥—ã
        document.getElementById('dailyRewardBtn')?.addEventListener('click', () => {
            this.claimDailyReward();
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä —Å–ª–µ–¥—É—é—â–µ–π –Ω–∞–≥—Ä–∞–¥—ã
        this.updateNextRewardTimer();
        setInterval(() => this.updateNextRewardTimer(), 60000);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–∞–≥–∞–∑–∏–Ω –ø–æ–¥–∞—Ä–∫–æ–≤ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
        this.setupGiftShopInSettings();
    }

    updateDisplay() {
        // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
        const balanceElement = document.getElementById('userBalance');
        if (balanceElement) {
            balanceElement.textContent = this.balance;
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ—Ä–∏—é
        const streakElement = document.getElementById('dailyStreak');
        if (streakElement) {
            streakElement.textContent = `${this.dailyStreak} –¥–Ω–µ–π`;
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é
        this.updateHistoryDisplay();

        // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞–≥–∞–∑–∏–Ω –ø–æ–¥–∞—Ä–∫–æ–≤ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
        this.updateGiftShopInSettings();
    }

    canClaimDailyReward() {
        if (!this.lastDailyReward) {
            console.log('‚úÖ No previous reward - can claim');
            return true;
        }

        const lastClaim = new Date(this.lastDailyReward);
        const now = new Date();
        
        // –ù–∞–≥—Ä–∞–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ä–∞–∑ –≤ 23 —á–∞—Å–∞
        const timeSinceLastReward = now - lastClaim;
        const hoursSinceLastReward = timeSinceLastReward / (1000 * 60 * 60);
        
        return hoursSinceLastReward >= 23;
    }

    updateNextRewardTimer() {
        const nextRewardElement = document.getElementById('nextRewardTime');
        if (!nextRewardElement) return;

        const canClaim = this.canClaimDailyReward();

        if (canClaim) {
            nextRewardElement.textContent = '–î–æ—Å—Ç—É–ø–Ω–æ —Å–µ–π—á–∞—Å!';
            nextRewardElement.style.color = '#28a745';
        } else {
            const now = new Date();
            const lastClaim = new Date(this.lastDailyReward);
            const nextRewardTime = new Date(lastClaim.getTime() + (23 * 60 * 60 * 1000));
            
            if (nextRewardTime <= now) {
                nextRewardElement.textContent = '–î–æ—Å—Ç—É–ø–Ω–æ —Å–µ–π—á–∞—Å!';
                nextRewardElement.style.color = '#28a745';
                return;
            }
            
            const timeUntilReward = nextRewardTime - now;
            const hours = Math.floor(timeUntilReward / (1000 * 60 * 60));
            const minutes = Math.floor((timeUntilReward % (1000 * 60 * 60)) / (1000 * 60));

            nextRewardElement.textContent = `–ß–µ—Ä–µ–∑ ${hours}—á ${minutes}–º`;
            nextRewardElement.style.color = '#6c757d';
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
        const rewardBtn = document.getElementById('dailyRewardBtn');
        if (rewardBtn) {
            rewardBtn.disabled = !canClaim;
            if (canClaim) {
                rewardBtn.innerHTML = 'üéÅ –ü–æ–ª—É—á–∏—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é –Ω–∞–≥—Ä–∞–¥—É';
                rewardBtn.style.background = 'linear-gradient(45deg, #28a745, #20c997)';
            } else {
                rewardBtn.innerHTML = '‚è≥ –ù–∞–≥—Ä–∞–¥–∞ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞';
                rewardBtn.style.background = 'rgba(255, 255, 255, 0.2)';
            }
        }
    }

    async claimDailyReward() {
        if (!this.canClaimDailyReward()) {
            this.showNotification('–í—ã —É–∂–µ –ø–æ–ª—É—á–∞–ª–∏ –Ω–∞–≥—Ä–∞–¥—É —Å–µ–≥–æ–¥–Ω—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.', 'error');
            return;
        }

        try {
            console.log('üéÅ Claiming daily reward for:', this.currentUser);
            
            // –õ–æ–∫–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –Ω–∞–≥—Ä–∞–¥—ã
            const result = this.calculateLocalReward();

            if (result && result.success) {
                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                this.balance = result.newBalance || this.balance + result.rewardAmount;
                this.dailyStreak = result.streak || this.dailyStreak + 1;
                this.lastDailyReward = new Date().toISOString();
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
                this.addTransaction({
                    type: 'daily_reward',
                    amount: result.rewardAmount || 50,
                    description: `–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞ (—Å–µ—Ä–∏—è: ${this.dailyStreak} –¥–Ω–µ–π)`,
                    timestamp: new Date().toISOString()
                });

                this.updateDisplay();
                this.showRewardNotification(result.rewardAmount || 50, this.dailyStreak);
                
                console.log('‚úÖ Daily reward claimed successfully', {
                    newBalance: this.balance,
                    newStreak: this.dailyStreak,
                    lastReward: this.lastDailyReward
                });
                
            } else {
                throw new Error(result?.error || 'Failed to claim reward');
            }
        } catch (error) {
            console.error('‚ùå Error claiming daily reward:', error);
            this.showNotification('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–≥—Ä–∞–¥—ã: ' + error.message, 'error');
        }
    }

    calculateLocalReward() {
        // –õ–æ–∫–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –Ω–∞–≥—Ä–∞–¥—ã
        const baseReward = 50;
        const streakBonus = Math.min(this.dailyStreak * 5, 100);
        const totalReward = baseReward + streakBonus;
        
        return {
            success: true,
            rewardAmount: totalReward,
            newBalance: this.balance + totalReward,
            streak: this.dailyStreak + 1
        };
    }

    addTransaction(transaction) {
        this.transactionHistory.unshift(transaction);
        if (this.transactionHistory.length > 50) {
            this.transactionHistory = this.transactionHistory.slice(0, 50);
        }
    }

    updateHistoryDisplay() {
        const historyElement = document.getElementById('currencyHistory');
        if (!historyElement) return;

        if (this.transactionHistory.length === 0) {
            historyElement.innerHTML = '<div class="history-empty">–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –ø—É—Å—Ç–∞</div>';
            return;
        }

        historyElement.innerHTML = this.transactionHistory.map(transaction => `
            <div class="history-item">
                <div class="history-info">
                    <div class="history-description">${transaction.description}</div>
                    <div class="history-date">${this.formatDate(transaction.timestamp)}</div>
                </div>
                <div class="history-amount ${transaction.amount >= 0 ? 'positive' : 'negative'}">
                    ${transaction.amount >= 0 ? '+' : ''}${transaction.amount}
                </div>
            </div>
        `).join('');
    }

    formatDate(timestamp) {
        const date = new Date(timestamp);
        return date.toLocaleDateString('ru-RU') + ' ' + date.toLocaleTimeString('ru-RU', {
            hour: '2-digit',
            minute: '2-digit'
        });
    }

    showRewardNotification(amount, streak) {
        const notification = document.createElement('div');
        notification.className = 'reward-notification';
        notification.innerHTML = `
            <div style="display: flex; align-items: center; gap: 10px;">
                <div style="font-size: 24px;">ü™ô</div>
                <div>
                    <div>üéâ –í—ã –ø–æ–ª—É—á–∏–ª–∏ ${amount} –º–æ–Ω–µ—Ç!</div>
                    ${streak > 1 ? `<div style="font-size: 12px; opacity: 0.9;">–°–µ—Ä–∏—è: ${streak} –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥!</div>` : ''}
                </div>
            </div>
        `;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∫ –∏–∫–æ–Ω–∫–µ –≤–∞–ª—é—Ç—ã –≤ –±–∞–ª–∞–Ω—Å–µ
        const currencyIcon = document.querySelector('.currency-icon');
        if (currencyIcon) {
            currencyIcon.classList.add('coin-animation');
            setTimeout(() => {
                currencyIcon.classList.remove('coin-animation');
            }, 800);
        }

        // –í—Å—Ç–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        const balanceDisplay = document.querySelector('.currency-balance');
        if (balanceDisplay) {
            balanceDisplay.parentNode.insertBefore(notification, balanceDisplay);
            
            // –£–±–∏—Ä–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateY(-20px)';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 3000);
        }
    }

    // –ú–∞–≥–∞–∑–∏–Ω –ø–æ–¥–∞—Ä–∫–æ–≤ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
    setupGiftShopInSettings() {
        this.loadGiftsToSettingsShop();
        this.setupGiftShopEventsInSettings();
    }

    loadGiftsToSettingsShop() {
        const giftsGrid = document.getElementById('giftsGrid');
        if (!giftsGrid) return;

        giftsGrid.innerHTML = '';

        if (!window.giftManager) {
            giftsGrid.innerHTML = '<div style="text-align: center; color: #6c757d; padding: 20px;">–ú–∞–≥–∞–∑–∏–Ω –ø–æ–¥–∞—Ä–∫–æ–≤ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</div>';
            return;
        }

        window.giftManager.gifts.forEach(gift => {
            const giftElement = document.createElement('div');
            giftElement.className = `gift-item ${gift.type}`;
            
            const isOwned = window.giftManager.isGiftOwned(gift.id);
            const canAfford = this.balance >= gift.price;
            
            giftElement.innerHTML = `
                <div class="gift-icon">${gift.name.split(' ')[0]}</div>
                <div class="gift-name">${gift.name}</div>
                <div class="gift-price">${gift.price} ü™ô</div>
                <div class="gift-type">
                    ${this.getGiftTypeBadge(gift.type)}
                </div>
                <button class="buy-gift-btn ${isOwned ? 'owned' : ''}" 
                        data-gift-id="${gift.id}"
                        ${isOwned ? 'disabled' : !canAfford ? 'disabled' : ''}>
                    ${isOwned ? '‚úÖ –ö—É–ø–ª–µ–Ω' : !canAfford ? 'üí∏ –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç' : 'üõí –ö—É–ø–∏—Ç—å'}
                </button>
            `;

            if (!isOwned && canAfford) {
                const buyBtn = giftElement.querySelector('.buy-gift-btn');
                buyBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.buyGiftFromSettings(gift);
                });
            }

            giftsGrid.appendChild(giftElement);
        });

        this.updateGiftShopInSettings();
    }

    getGiftTypeBadge(type) {
        const badges = {
            'common': '<span style="background: #6c757d; color: white; padding: 2px 6px; border-radius: 10px; font-size: 9px;">–û–±—ã—á–Ω—ã–π</span>',
            'rare': '<span style="background: #007bff; color: white; padding: 2px 6px; border-radius: 10px; font-size: 9px;">–†–µ–¥–∫–∏–π</span>',
            'epic': '<span style="background: #6f42c1; color: white; padding: 2px 6px; border-radius: 10px; font-size: 9px;">–≠–ø–∏—á–µ—Å–∫–∏–π</span>',
            'legendary': '<span style="background: #fd7e14; color: white; padding: 2px 6px; border-radius: 10px; font-size: 9px;">–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π</span>'
        };
        return badges[type] || badges.common;
    }

    setupGiftShopEventsInSettings() {
        const categoryBtns = document.querySelectorAll('#tab-currency .category-btn');
        const giftsGrid = document.getElementById('giftsGrid');

        categoryBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                categoryBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                this.filterGiftsInSettings(btn.dataset.category);
            });
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞–≥–∞–∑–∏–Ω –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É –≤–∞–ª—é—Ç—ã
        const currencyTab = document.querySelector('.settings-tab[data-tab="currency"]');
        if (currencyTab) {
            currencyTab.addEventListener('click', () => {
                setTimeout(() => {
                    this.loadGiftsToSettingsShop();
                }, 100);
            });
        }
    }

    filterGiftsInSettings(category) {
        if (!window.giftManager) return;

        const giftItems = document.querySelectorAll('#giftsGrid .gift-item');
        giftItems.forEach(item => {
            const giftName = item.querySelector('.gift-name').textContent;
            const gift = window.giftManager.gifts.find(g => g.name === giftName);
            
            if (category === 'all' || gift.category === category) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
    }

    async buyGiftFromSettings(gift) {
        if (!window.giftManager) {
            this.showNotification('–ú–∞–≥–∞–∑–∏–Ω –ø–æ–¥–∞—Ä–∫–æ–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
            return;
        }

        try {
            await window.giftManager.buyGift(gift);
            this.loadGiftsToSettingsShop();
            this.updateDisplay();
        } catch (error) {
            console.error('Error buying gift from settings:', error);
        }
    }

    updateGiftShopInSettings() {
        this.updateGiftShopBalanceInSettings();
        this.updateUserGiftsListInSettings();
    }

    updateGiftShopBalanceInSettings() {
        const balanceElement = document.getElementById('userBalance');
        if (balanceElement) {
            balanceElement.textContent = this.balance;
        }

        const ownedCountElement = document.getElementById('ownedGiftsCount');
        if (ownedCountElement && window.giftManager) {
            const currentUser = document.getElementById('username')?.textContent;
            const ownedCount = window.giftManager.userGifts.get(currentUser)?.length || 0;
            ownedCountElement.textContent = ownedCount;
        }
    }

    updateUserGiftsListInSettings() {
        const userGiftsList = document.getElementById('userGiftsList');
        if (!userGiftsList || !window.giftManager) return;

        const currentUser = document.getElementById('username')?.textContent;
        const userGifts = window.giftManager.userGifts.get(currentUser) || [];

        if (userGifts.length === 0) {
            userGiftsList.innerHTML = '<div style="text-align: center; color: #6c757d; padding: 10px; font-size: 11px;">–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ–¥–∞—Ä–∫–æ–≤</div>';
            return;
        }

        userGiftsList.innerHTML = userGifts.map(gift => `
            <div class="owned-gift-item" title="${gift.name} (–∫—É–ø–ª–µ–Ω ${new Date(gift.purchaseDate).toLocaleDateString()})">
                <div class="owned-gift-icon">${gift.name.split(' ')[0]}</div>
                <div class="owned-gift-name">${gift.name.split(' ').slice(1).join(' ')}</div>
            </div>
        `).join('');
    }

    showNotification(message, type = 'info') {
        // –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 10010;
            background: ${type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : '#17a2b8'};
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            if (notification.parentElement) {
                notification.remove();
            }
        }, 3000);
    }
}

// –ö–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–∞—Ä–∫–∞–º–∏
class GiftManager {
    constructor() {
        this.gifts = [
            { id: 'gift_1', name: 'üéà –í–æ–∑–¥—É—à–Ω—ã–π —à–∞—Ä–∏–∫', price: 10, type: 'common', category: 'decor' },
            { id: 'gift_2', name: 'üéÅ –ü–æ–¥–∞—Ä–æ–∫', price: 25, type: 'common', category: 'gift' },
            { id: 'gift_3', name: 'üèÜ –ö—É–±–æ–∫', price: 50, type: 'rare', category: 'achievement' },
            { id: 'gift_4', name: 'üëë –ö–æ—Ä–æ–Ω–∞', price: 100, type: 'epic', category: 'premium' },
            { id: 'gift_5', name: '‚≠ê –ó–≤–µ–∑–¥–∞', price: 30, type: 'common', category: 'decor' },
            { id: 'gift_6', name: 'üíñ –°–µ—Ä–¥—Ü–µ', price: 40, type: 'common', category: 'emotion' },
            { id: 'gift_7', name: 'üöÄ –†–∞–∫–µ—Ç–∞', price: 75, type: 'rare', category: 'premium' },
            { id: 'gift_8', name: 'üé® –ü–∞–ª–∏—Ç—Ä–∞', price: 35, type: 'common', category: 'creativity' },
            { id: 'gift_9', name: 'üèÖ –ú–µ–¥–∞–ª—å', price: 60, type: 'rare', category: 'achievement' },
            { id: 'gift_10', name: 'üíé –ê–ª–º–∞–∑', price: 150, type: 'legendary', category: 'premium' }
        ];
        
        this.userGifts = new Map();
        
        this.init();
    }

    async init() {
        await this.loadUserGifts();
        console.log('‚úÖ GiftManager initialized');
    }

    async loadUserGifts() {
        try {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞
            const testGifts = {
                'user1': [
                    { id: 'gift_1', name: 'üéà –í–æ–∑–¥—É—à–Ω—ã–π —à–∞—Ä–∏–∫', purchaseDate: new Date().toISOString(), price: 10 },
                    { id: 'gift_5', name: '‚≠ê –ó–≤–µ–∑–¥–∞', purchaseDate: new Date().toISOString(), price: 30 }
                ]
            };
            
            Object.entries(testGifts).forEach(([username, gifts]) => {
                this.userGifts.set(username, gifts);
            });
            
        } catch (error) {
            console.log('‚ö†Ô∏è Using local gift data');
        }
    }

    isGiftOwned(giftId) {
        const currentUser = document.getElementById('username')?.textContent;
        if (!currentUser || !this.userGifts.has(currentUser)) return false;
        
        return this.userGifts.get(currentUser).some(gift => gift.id === giftId);
    }

    async buyGift(gift) {
        const currentUser = document.getElementById('username')?.textContent;
        if (!currentUser) {
            this.showNotification('–û—à–∏–±–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω', 'error');
            return;
        }

        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å
            if (!window.currencyManager || window.currencyManager.balance < gift.price) {
                this.showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç –¥–ª—è –ø–æ–∫—É–ø–∫–∏', 'error');
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–∞–∫–æ–π –ø–æ–¥–∞—Ä–æ–∫
            if (this.isGiftOwned(gift.id)) {
                this.showNotification('–£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å —ç—Ç–æ—Ç –ø–æ–¥–∞—Ä–æ–∫', 'error');
                return;
            }

            // –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤
            window.currencyManager.balance -= gift.price;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–∞—Ä–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            if (!this.userGifts.has(currentUser)) {
                this.userGifts.set(currentUser, []);
            }
            
            this.userGifts.get(currentUser).push({
                id: gift.id,
                name: gift.name,
                purchaseDate: new Date().toISOString(),
                price: gift.price
            });

            this.showNotification(`üéâ –í—ã –∫—É–ø–∏–ª–∏ ${gift.name} –∑–∞ ${gift.price} –º–æ–Ω–µ—Ç!`, 'success');
            
        } catch (error) {
            console.error('‚ùå Gift purchase error:', error);
            this.showNotification('–û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏ –ø–æ–¥–∞—Ä–∫–∞', 'error');
        }
    }

    showNotification(message, type = 'info') {
        // –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 10010;
            background: ${type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : '#17a2b8'};
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            if (notification.parentElement) {
                notification.remove();
            }
        }, 3000);
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Starting application initialization...');
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä—ã
    if (!window.currencyManager) {
        window.currencyManager = new CurrencyManager();
        console.log('‚úÖ CurrencyManager initialized');
    }
    
    if (!window.giftManager) {
        window.giftManager = new GiftManager();
        console.log('‚úÖ GiftManager initialized');
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
    document.getElementById('settingsBtn')?.addEventListener('click', function() {
        const modal = document.getElementById('settingsModal');
        if (modal) {
            modal.style.display = 'flex';
        }
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
    document.querySelectorAll('.close-modal').forEach(btn => {
        btn.addEventListener('click', function() {
            this.closest('.modal-overlay').style.display = 'none';
        });
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–ª–∏–∫–∞ –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    document.querySelectorAll('.modal-overlay').forEach(modal => {
        modal.addEventListener('click', function(e) {
            if (e.target === this) {
                this.style.display = 'none';
            }
        });
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
    document.querySelectorAll('.settings-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
            document.querySelectorAll('.settings-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.settings-tab-content').forEach(c => c.classList.remove('active'));
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ç–µ–∫—É—â–µ–π –≤–∫–ª–∞–¥–∫–µ
            this.classList.add('active');
            const tabName = this.getAttribute('data-tab');
            document.getElementById(`tab-${tabName}`).classList.add('active');

            // –ï—Å–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É –≤–∞–ª—é—Ç—ã, –æ–±–Ω–æ–≤–ª—è–µ–º –º–∞–≥–∞–∑–∏–Ω
            if (tabName === 'currency' && window.currencyManager) {
                setTimeout(() => {
                    window.currencyManager.loadGiftsToSettingsShop();
                }, 100);
            }
        });
    });
});
